# Delta Robot 4-DOF Control System

Система управления дельта-роботом на базе STM32 Nucleo.

## Особенности

- Реализована полная кинематика дельта-робота (прямая и обратная)
- Управление шаговыми двигателями с трапецеидальным профилем скорости (будет заменён на сплайны)
- Многоуровневая система безопасности
- Real-time планировщик задач
- Расширяемая архитектура
- Серийный интерфейс управления
- Поддержка внешнего веб-интерфейса на WebSockets

---
## 1. Структура проекта
```
DeltaRobot/
├── DeltaRobot.ino # Основной файл
├── src/ # Исходный код
│ ├── Core/ # Ядро системы
│ │ ├── Core.h/cpp
│ │ ├── RobotState.h/cpp
│ │ ├── TrajectoryGenerator.h/cpp # Генерация траекторий движения
│ │ └── Kinematics/ # Кинематика
│ │   ├── Kinematics.h/cpp # Прямая и обратная задачи кинематики
│ │   └── DeltaSolver.h/cpp # Решение задач, учитывающее лимиты
│ ├── DrivesController/ # Управление приводами
│ │ ├── DrivesController.h/cpp
│ │ ├── Drive.h/cpp # Управление одним приводом
│ │ └── FeedbackReader.h/cpp # Чтение обратной связи с приводов
│ ├── UI/ # Пользовательский интерфейс
│ │ ├── UI.h/cpp
│ │ └── CommandParser.h/cpp # Парсер текстовых команд пользователя
│ ├── Scheduler/ # Планировщик асинхронных задач
│ │ └── Scheduler.h/cpp
│ ├── Safety/ # Экстренная система безопасности
│ │ └── EmergencySystem.h/cpp
│ └── utils/ # Вспомогательные утилиты
│   ├── Vector3.h
│   ├── CircularBuffer.h # Асинхронный буфер хранения команд
│   ├── MathUtils.h
│   └── Logger.h
└── config/ # Конфигурационные файлы
  ├── pins_config.h # Конфигурация пинов
  ├── robot_params.h # Параметры робота
  └── limits.h # Пределы движения
```

### Список и описание файлов проекта

1. **Главные файлы:**
   - `DeltaRobot.ino` - основной файл для ArduinoIDE

2. **Конфигурация:**
   - `config/pins_config.h` - конфигурация пинов
   - `config/robot_params.h` - параметры робота
   - `config/limits.h` - пределы движения

3. **Утилиты:**
   - `src/utils/Vector3.h` - 3D вектор
   - `src/utils/CircularBuffer.h` - кольцевой буфер команд
   - `src/utils/MathUtils.h` - математические функции
   - `src/utils/Logger.h` - система логирования

4. **Безопасность:**
   - `src/Safety/EmergencySystem.h/cpp` - система аварийной остановки

5. **Планировщик:**
   - `src/Scheduler/Scheduler.h/cpp` - планировщик задач

6. **Кинематика:**
   - `src/Core/Kinematics/Kinematics.h/cpp` - решение обратной и прямой задач кинематики
   - `src/Core/Kinematics/DeltaSolver.h/cpp` - решатель кинематики, учитывающий лимиты
   
7. **Ядро системы:**
   - `src/Core/Core.h/cpp` - ядро системы
   - `src/Core/RobotState.h/cpp` - хранение состояния робота
   - `src/Core/TrajectoryGenerator.h/cpp` - генератор траекторий движения

8. **Управление приводами:**
   - `src/DrivesController/DrivesController.h/cpp` - контроллер приводов
   - `src/DrivesController/Drive.h/cpp` - драйвер шагового двигателя
   - `src/DrivesController/FeedbackReader.h/cpp` - чтение обратной связи

9. **Пользовательский интерфейс:**
   - `src/UI/UI.h/cpp` - пользовательский интерфейс
   - `src/UI/CommandParser.h/cpp` - парсер текстовых команд пользователя

---
## 2. Технические и программные требования
> - Плата STM32 Nucleo-F401RE
> - Драйверы шаговых двигателей (например, TMC2209, A4988)
> - Шаговые двигатели (например, NEMA 17)
> - Концевики для выставлния в начальное положение
> - Блок питания 12V 5+A
> - /// Программные: ///
> - Arduino IDE с поддержкой STM32, или PlatformIO
> - Библиотеки для STM32

### Настройка

1. **Подключение аппаратуры:**
    - Настройте пины в `config/pins_config.h`
    - Подключите драйверы двигателей согласно схеме
    - Установите концевики

2. **Настройка параметров робота:**
    - Отредактируйте `config/robot_params.h`
    - Установите длины звеньев, радиусы и т.д.
    - Настройте пределы движения в `config/limits.h`

3. **Настройка приводов (опционально):**
    - Установите микрошаги на драйверах
    - Настройте ток двигателей
    - Откалибруйте передаточные отношения

---
## 3. Компиляция, загрузка и все о коде

> ### Использование Arduino IDE
> 1. Установите поддержку STM32 через Board Manager
> 2. Выберите плату: Nucleo-64 > Nucleo F401RE
> 3. Загрузите скетч

> ### Использование PlatformIO
> ```bash
> platformio run --target upload
> ```

### Безопасность
1. Аппаратные концевики (?)
2. Программные пределы движения
3. Мониторинг напряжения и температуры
4. Аварийная кнопка остановки

### Расширение программы
1. Новые команды: добавьте через `UI::setupDefaultCommands()`
2. Новые типы траекторий: расширьте `TrajectoryGenerator`
3. Поддержка новых датчиков: создайте класс датчика в `FeedbackReader`

### Web-интерфейс через WebSockets (будет добавлен в будущем)
Архитектура подготовлена для добавления WebSocket интерфейса.
Используйте `StateSubscriptionCallback` для отправки данных.

### Отладка
Включите режим отладки в UI::Config:
```C++
config.debug_mode = true;
```

Команды отладки:
```
diag    - Запуск диагностики
status  - Статус системы
```

---
## 4. Основные команды управления
```
help                    - Показать справку
move X Y Z [V]          - Движение к точке (мм) со скоростью V (мм/с)
teach X Y Z [ID]        - Сохранение точки под заданным ID
move [ID] [V]           - Движение к сохраненной точке со скоростью V (мм/с)
joints A1 A2 A3 [V]     - Движение шарниров (градусы)
home                    - Калибровка (homing)
stop                    - Остановка движения
estop                   - Аварийная остановка
status                  - Статус системы
```


#### Примеры
```
move 100 50 -400 50     - Перемещение в точку (100,50,-400) со скоростью 50 мм/с
move Point1             - Перемещение в точку с ID: "Point1" со скоростью по умолчанию
joints 30 45 60         - Установка углов шарниров 30°, 45°, 60°
home                    - Выполнить калибровку
```
