# Delta Robot 4-DOF Control System

Система управления дельта-роботом на базе STM32 Nucleo.

## Особенности

- Реализована полная кинематика дельта-робота (прямая и обратная)
- Управление шаговыми двигателями с трапецеидальным профилем скорости
- Многоуровневая система безопасности
- Real-time планировщик задач
- Расширяемая архитектура
- Серийный интерфейс управления
- Подготовка для Web-интерфейса

## Структура проекта
```
DeltaRobot/
├── DeltaRobot.ino # Основной файл
├── src/ # Исходный код
│ ├── Core/ # Ядро системы
│ │ ├── Core.h/cpp
│ │ ├── RobotState.h/cpp
│ │ ├── TrajectoryGenerator.h/cpp
│ │ └── Kinematics/ # Кинематика
│ │ ├── Kinematics.h/cpp
│ │ └── DeltaSolver.h/cpp
│ ├── DrivesController/ # Управление приводами
│ │ ├── DrivesController.h/cpp
│ │ ├── Drive.h/cpp
│ │ └── FeedbackReader.h/cpp
│ ├── UI/ # Пользовательский интерфейс
│ │ ├── UI.h/cpp
│ │ └── CommandParser.h/cpp
│ ├── Scheduler/ # Планировщик асинхронных задач
│ │ └── Scheduler.h/cpp
│ ├── Safety/ # Система безопасности
│ │ └── EmergencySystem.h/cpp
│ └── utils/ # Вспомогательные утилиты
│ ├── Vector3.h
│ ├── CircularBuffer.h
│ ├── MathUtils.h
│ └── Logger.h
└── config/ # Конфигурационные файлы
  ├── pins_config.h # Конфигурация пинов
  ├── robot_params.h # Параметры робота
  └── limits.h # Пределы движения
```

---

### Полный список файлов проекта:

1. **Главные файлы:**
   - `DeltaRobot.ino` - главный файл Arduino
   - `README.md` - документация

2. **Конфигурация:**
   - `config/pins_config.h` - конфигурация пинов
   - `config/robot_params.h` - параметры робота
   - `config/limits.h` - пределы движения

3. **Утилиты:**
   - `src/utils/Vector3.h` - 3D вектор
   - `src/utils/CircularBuffer.h` - кольцевой буфер
   - `src/utils/MathUtils.h` - математические функции
   - `src/utils/Logger.h` - система логгирования

4. **Безопасность:**
   - `src/Safety/EmergencySystem.h/cpp` - система аварийной остановки

5. **Планировщик:**
   - `src/Scheduler/Scheduler.h/cpp` - планировщик задач

6. **Кинематика:**
   - `src/Core/Kinematics/Kinematics.h/cpp` - интерфейс кинематики
   - `src/Core/Kinematics/DeltaSolver.h/cpp` - решатель кинематики

7. **Ядро системы:**
   - `src/Core/Core.h/cpp` - ядро системы
   - `src/Core/RobotState.h/cpp` - состояние робота
   - `src/Core/TrajectoryGenerator.h/cpp` - генератор траекторий

8. **Управление приводами:**
   - `src/DrivesController/DrivesController.h/cpp` - контроллер приводов
   - `src/DrivesController/Drive.h/cpp` - драйвер шагового двигателя
   - `src/DrivesController/FeedbackReader.h/cpp` - чтение обратной связи

9. **Пользовательский интерфейс:**
   - `src/UI/UI.h/cpp` - пользовательский интерфейс
   - `src/UI/CommandParser.h/cpp` - парсер команд

---

**Проект готов!** Это полная профессиональная система управления дельта-роботом с модульной архитектурой, системой безопасности и расширяемостью.

## Требования

1. **Аппаратные:**
    - Плата STM32 Nucleo-F401RE
    - 3x драйверы шаговых двигателей (например, TMC2209, A4988)
    - 3x шаговые двигатели NEMA 17
    - Концевики для homing
    - Блок питания 12V/5A

2. **Программные:**
    - Arduino IDE с поддержкой STM32
    - Или PlatformIO
    - Библиотеки для STM32

## Настройка

1. **Подключение аппаратуры:**
    - Настройте пины в `config/pins_config.h`
    - Подключите драйверы двигателей согласно схеме
    - Установите концевики

2. **Настройка параметров робота:**
    - Отредактируйте `config/robot_params.h`
    - Установите длины звеньев, радиусы и т.д.
    - Настройте пределы движения в `config/limits.h`

3. **Настройка приводов:**
    - Установите микрошаги на драйверах
    - Настройте ток двигателей
    - Откалибруйте передаточные отношения

## Компиляция и загрузка

### Использование Arduino IDE:
1. Установите поддержку STM32 через Board Manager
2. Выберите плату: Nucleo-64 > Nucleo F401RE
3. Загрузите скетч

### Использование PlatformIO:
```bash
platformio run --target upload
```

### Безопасность
1. Система включает многоуровневую защиту:
2. Аппаратные концевики
3. Программные пределы движения
4. Мониторинг напряжения и температуры
5. Аварийная кнопка 
6. Watchdog таймер

### Расширение
#### Добавление новых функций:
1. Новые команды: добавьте в `UI::setupDefaultCommands()`
2. Новые типы траекторий: расширьте `TrajectoryGenerator`
3. Поддержка новых датчиков: создайте класс в `FeedbackReader`

#### Web-интерфейс:
Архитектура подготовлена для добавления WebSocket интерфейса.
Используйте `StateSubscriptionCallback` для отправки данных.

### Отладка
Включите режим отладки в UI::Config:
```C++
config.debug_mode = true;
```

Используйте команды:
```
diag    - Запуск диагностики
status  - Статус системы
```

## Основные команды:
```
help                    - Показать справку
move X Y Z [V]          - Движение к точке (мм) со скоростью V (мм/с)
joints A1 A2 A3 [V]     - Движение шарниров (градусы)
home                    - Калибровка (homing)
stop                    - Остановка движения
estop                   - Аварийная остановка
status                  - Статус системы
teach X Y Z [ID]        - Сохранение точки
```


## Примеры
```
move 100 50 -400 50     - Перемещение в точку (100,50,-400) со скоростью 50 мм/с
joints 30 45 60         - Установка углов шарниров 30°, 45°, 60°
home                    - Выполнить калибровку
```
